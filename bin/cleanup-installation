#!/usr/bin/env bash

########################################################################################################################
# TYPO3 cleanup before installation
#-----------------------------------------------------------------------------------------------------------------------
printf "\e[1;34m==>\e[1;37m TYPO3 \e[0m \n"

S_TIME=$SECONDS
printf "\e[1;33m==>\e[1;37m TYPO3 clean \e[1;33m root \e[0m"
rm -rf \
    .docker-sync \
    vendor \
    .env \

printf "\e[1;32m DONE \e[0m"
E_TIME=$(($SECONDS - $S_TIME))
printf "%02d:%02d\n" $(($E_TIME/60)) $(($E_TIME%60))
#-----------------------------------------------------------------------------------------------------------------------
S_TIME=$SECONDS
printf "\e[1;33m==>\e[1;37m TYPO3 clean \e[1;33m bin \e[0m"
rm -rf \
    bin/mage \
    bin/phpunit \
    bin/typo3cms \

printf "\e[1;32m DONE \e[0m"
E_TIME=$(($SECONDS - $S_TIME))
printf "%02d:%02d\n" $(($E_TIME/60)) $(($E_TIME%60))
#-----------------------------------------------------------------------------------------------------------------------
S_TIME=$SECONDS
printf "\e[1;33m==>\e[1;37m TYPO3 clean \e[1;33m docker \e[0m"
rm -rf \
    docker/content-dump/* \
    docker/logs/*
rm -rf docker/mysql-data >/dev/null 2>&1 \
    && printf "\e[1;32m DONE \e[0m" || printf "\e[0m \e[1;31m failed [rm -rf docker/mysql-data], might need sudo \e[0m"

printf "\e[1;32m DONE \e[0m"
E_TIME=$(($SECONDS - $S_TIME))
printf "%02d:%02d\n" $(($E_TIME/60)) $(($E_TIME%60))
#-----------------------------------------------------------------------------------------------------------------------
S_TIME=$SECONDS
printf "\e[1;33m==>\e[1;37m TYPO3 clean \e[1;33m web \e[0m"
rm -rf \
        web/fileadmin \
        web/typo3 \
        web/typo3conf/ENABLE_INSTALL_TOOL \
        web/typo3conf/LocalConfiguration.php \
        web/typo3conf/PackageStates.php \
        web/typo3conf/ext/fluidcontent \
        web/typo3conf/ext/fluidpages \
        web/typo3conf/ext/flux \
        web/typo3conf/ext/metaseo \
        web/typo3conf/ext/realurl \
        web/typo3conf/ext/sourceopt \
        web/typo3conf/ext/static_info_tables \
        web/typo3conf/ext/vhs \
        web/typo3conf/l10n \
        web/typo3conf/*.log \
        web/typo3temp \
        web/uploads \
        web/index.php \

printf "\e[1;32m DONE \e[0m"
E_TIME=$(($SECONDS - $S_TIME))
printf "%02d:%02d\n" $(($E_TIME/60)) $(($E_TIME%60))
#-----------------------------------------------------------------------------------------------------------------------
S_TIME=$SECONDS
printf "\e[1;33m==>\e[1;37m TYPO3 clean \e[1;33m var \e[0m"
rm -rf \
    var/cache/cached-* \

printf "\e[1;32m DONE \e[0m"
E_TIME=$(($SECONDS - $S_TIME))
printf "%02d:%02d\n" $(($E_TIME/60)) $(($E_TIME%60))
#=======================================================================================================================
